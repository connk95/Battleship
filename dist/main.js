(()=>{"use strict";class e{constructor(e){this.size=e,this.board=this.createBoard(e),this.shots=[],this.hits=[],this.ships=[]}createBoard(e=this.size){let t=[];for(let s=0;s<e;s++){t[s]=[];for(let i=0;i<e;i++)t[s][i]=i}return t}placeShip(e,t,s,i){let l=[];return"battleship"==e&&("vertical"==i?l.push([t,s],[t,s+1],[t,s+2],[t,s+3]):"horizontal"==i&&l.push([t,s],[t+1,s],[t+2,s],[t+3,s])),"carrier"==e&&("vertical"==i?l.push([t,s],[t,s+1],[t,s+2],[t,s+3],[t,s+4]):"horizontal"==i&&l.push([t,s],[t+1,s],[t+2,s],[t+3,s],[t+4,s])),"cruiser"==e&&("vertical"==i?l.push([t,s],[t,s+1]):"horizontal"==i&&l.push([t,s],[t+1,s])),"destroyer"==e&&("vertical"==i?l.push([t,s],[t,s+1],[t,s+2]):"horizontal"==i&&l.push([t,s],[t+1,s],[t+2,s])),"submarine"==e&&("vertical"==i?l.push([t,s],[t,s+1],[t,s+2]):"horizontal"==i&&l.push([t,s],[t+1,s],[t+2,s])),l}receiveAttack(e,t){let s=[e,t];this.shots.push(s);for(let i=0;i<this.ships.length;i++)for(let l=0;l<this.ships[i].location.length;l++)if(e==this.ships[i].location[l][0]&&t==this.ships[i].location[l][1])return this.hits.push(s),this.ships[i].hit(s),alert("Hit!"),[e,t];return alert("Miss!"),!1}}class t{constructor(e,t){this.name=e,this.size=t,this.location=[],this.hits=[],this.sunk=!1}hit(e){if(this.hits.push(e),1==this.isSunk())return!0}isSunk(){return this.hits.length==this.size&&(this.sunk=!0,alert(`You sunk my ${this.name}!`)),!0}}class s{constructor(t,s){this.isHuman=t,this.turn=s,this.myBoard=new e(10),this.myShips=[],this.shots=[],this.myHits=[],this.shotSearch=[]}place(e,s,i,l,h){if("vertical"==h&&l+s>this.myBoard.size)return void alert("Please select a valid location!");if("horizontal"==h&&i+s>this.myBoard.size)return void alert("Please select a valid location!");for(let e=0;e<this.myShips.length;e++)for(let t=0;t<this.myShips[e].location.length;t++){let s=this.myShips[e].location[t][0],h=this.myShips[e].location[t][1];if(s==i&&h==l)return void alert("There is already a ship here!")}let a=new t(e,s);a.location=this.myBoard.placeShip(e,i,l,h),this.myBoard.ships.push(a),this.myShips.push(a)}shoot(e,t,s){let i=[e,t];for(let s=0;s<this.shots.length;s++)if(e==this.shots[s][0]&&t==this.shots[s][1])return void alert("You cannot target the same spot twice!");this.shots.push(i);const l=s.myBoard.receiveAttack(e,t);if(0!=l)return this.myHits.push(l),!0}aiPlace(e,s){let i=Math.floor(Math.random()*(this.myBoard.size-s)),l=Math.floor(Math.random()*this.myBoard.size),h=Math.floor(Math.random()*this.myBoard.size),a=Math.floor(Math.random()*(this.myBoard.size-s));for(let e=0;e<this.myShips.length;e++)for(let t=0;t<this.myShips[e].location.length;t++){let s=this.myShips[e].location[t][0],o=this.myShips[e].location[t][1];if(s==h&&o==a||s==i&&o==l)return}let o=new t(e,s),r=Math.round(Math.random());o.location=r>0?this.myBoard.placeShip(e,i,l,"horizontal"):this.myBoard.placeShip(e,h,a,"vertical"),this.myBoard.ships.push(o),this.myShips.push(o)}aiShoot(e){if(0!=this.shotSearch.length){let t=this.shotSearch[0][0],s=this.shotSearch[0][1];for(let e=0;e<this.shots.length;e++)if(t==this.shots[e][0]&&s==this.shots[e][1])return;let i=e.myBoard.receiveAttack(t,s);this.shots.push([t,s]),0!=i?(this.myHits.push(i),this.shotSearch=[],this.aiDestroy()):this.shotSearch.shift()}else{let t=Math.floor(Math.random()*e.myBoard.size),s=Math.floor(Math.random()*e.myBoard.size);for(let e=0;e<this.shots.length;e++)if(t==this.shots[e][0]&&s==this.shots[e][1])return;let i=e.myBoard.receiveAttack(t,s);this.shots.push([t,s]),0!=i&&(this.myHits.push(i),this.shotSearch=[],this.aiDestroy())}}aiDestroy(){if(1==this.myHits.length){const e=this.myHits[0][0],t=this.myHits[0][1];t<9&&this.shotSearch.push([e,t+1]),t>0&&this.shotSearch.push([e,t-1]),e>0&&this.shotSearch.push([e-1,t]),e<9&&this.shotSearch.push([e+1,t])}else if(this.myHits.length>1){const e=this.myHits[0][0],t=this.myHits[0][1],s=this.myHits[this.myHits.length-1][0],i=this.myHits[this.myHits.length-1][1];e==s?this.shotSearch.push([e,t-1],[s,i+1]):t==i&&this.shotSearch.push([e-1,t],[s+1,i])}}}document.getElementById("content");const i=document.getElementById("myGrid"),l=document.getElementsByClassName("myTile"),h=document.getElementById("aiGrid"),a=document.getElementsByClassName("aiTile");h.style.visibility="hidden";const o=document.getElementById("preview"),r=new s(!0,!0),d=new s(!1,!1);let n=!0;const c=document.getElementById("direction");let m="vertical";c.addEventListener("click",(()=>{"vertical"==m?(m="horizontal",o.style.flexDirection="row"):"horizontal"==m&&(m="vertical",o.style.flexDirection="column")}));const p=()=>{for(;d.myShips.length<5;)if(0==d.myShips.length)d.aiPlace("carrier",5);else if(1==d.myShips.length)d.aiPlace("battleship",4);else if(2==d.myShips.length)d.aiPlace("destroyer",4);else if(3==d.myShips.length)d.aiPlace("submarine",4);else{if(4!=d.myShips.length)break;d.aiPlace("cruiser",2)}},y=()=>{if(0==r.myShips.length){let e=document.createElement("div");e.classList.add("previewTile"),o.appendChild(e);for(let e=0;e<4;e++){let e=document.createElement("div");e.classList.add("previewDisplay"),o.appendChild(e)}}else if(1==r.myShips.length){let e=document.createElement("div");e.classList.add("previewTile"),o.appendChild(e);for(let e=0;e<3;e++){let e=document.createElement("div");e.classList.add("previewDisplay"),o.appendChild(e)}}else if(2==r.myShips.length){let e=document.createElement("div");e.classList.add("previewTile"),o.appendChild(e);for(let e=0;e<2;e++){let e=document.createElement("div");e.classList.add("previewDisplay"),o.appendChild(e)}}else if(3==r.myShips.length){let e=document.createElement("div");e.classList.add("previewTile"),o.appendChild(e);for(let e=0;e<2;e++){let e=document.createElement("div");e.classList.add("previewDisplay"),o.appendChild(e)}}else if(4==r.myShips.length){let e=document.createElement("div");e.classList.add("previewTile"),o.appendChild(e);for(let e=0;e<1;e++){let e=document.createElement("div");e.classList.add("previewDisplay"),o.appendChild(e)}}else for(;o.firstChild;)o.removeChild(o.firstChild)},u=(e,t,s)=>{let i=0;for(let l=0;l<e;l++){let h=document.createElement("div");h.id=l,t.appendChild(h);for(let t=0;t<e;t++){let e=document.createElement("div");e.id=i<10?`0${i}`:i,i++,1==s?e.classList.add("myTile"):0==s&&e.classList.add("aiTile"),e.addEventListener("mouseenter",(()=>{e.classList.add("hover")})),e.addEventListener("mouseleave",(()=>{e.classList.remove("hover")})),h.appendChild(e)}}},f=()=>{1!=n&&0==n&&(d.aiShoot(r),console.log(r.myShips),n=!0)},v=()=>{for(let e=0;e<a.length;e++)a[e].addEventListener("click",(()=>{if(0!=n){if(1==n){let t=String(l[e].id)[0],s=Number(t),i=String(l[e].id).slice(-1),h=Number(i);1==r.shoot(s,h,d)?a[e].classList.add("hit"):a[e].classList.add("shot"),n=!1,console.log(d.myShips),setTimeout(f,3e3)}}else alert("It's not your turn!")}))};u(10,i,!0),y(),(()=>{for(let e=0;e<l.length;e++)l[e].addEventListener("click",(()=>{const t=String(l[e].id)[0],s=Number(t),i=String(l[e].id).slice(-1),a=Number(i);if(r.myShips.length<5){if(0==r.myShips.length){if(r.place("carrier",5,s,a,m),"vertical"==m&&a<6){l[e].classList.add("placed");for(let e=0;e<5;e++)document.getElementById(`${s}${a+e}`).classList.add("placed")}else if("horizontal"==m&&s<6){l[e].classList.add("placed");for(let e=0;e<5;e++)document.getElementById(`${s+e}${a}`).classList.add("placed")}}else if(1==r.myShips.length){if(r.place("battleship",4,s,a,m),"vertical"==m&&a<7){l[e].classList.add("placed");for(let e=0;e<4;e++)document.getElementById(`${s}${a+e}`).classList.add("placed")}else if("horizontal"==m&&s<7){l[e].classList.add("placed");for(let e=0;e<4;e++)document.getElementById(`${s+e}${a}`).classList.add("placed")}}else if(2==r.myShips.length){if(r.place("destroyer",3,s,a,m),"vertical"==m&&a<8){l[e].classList.add("placed");for(let e=0;e<3;e++)document.getElementById(`${s}${a+e}`).classList.add("placed")}else if("horizontal"==m&&s<8){l[e].classList.add("placed");for(let e=0;e<3;e++)document.getElementById(`${s+e}${a}`).classList.add("placed")}}else if(3==r.myShips.length){if(r.place("submarine",3,s,a,m),"vertical"==m&&a<8){l[e].classList.add("placed");for(let e=0;e<3;e++)document.getElementById(`${s}${a+e}`).classList.add("placed")}else if("horizontal"==m&&s<8){l[e].classList.add("placed");for(let e=0;e<3;e++)document.getElementById(`${s+e}${a}`).classList.add("placed")}}else if(4==r.myShips.length){if(r.place("cruiser",2,s,a,m),"vertical"==m&&a<9){l[e].classList.add("placed");for(let e=0;e<2;e++)document.getElementById(`${s}${a+e}`).classList.add("placed")}else if("horizontal"==m&&s<9){l[e].classList.add("placed");for(let e=0;e<2;e++)document.getElementById(`${s+e}${a}`).classList.add("placed")}}else alert("You have no ships remaining!");for(;o.firstChild;)o.removeChild(o.firstChild);y(),console.log(r.myShips)}5==r.myShips.length&&(p(),h.style.visibility="visible",v())}))})(),u(10,h,!1),console.log(d.myShips)})();