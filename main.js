(()=>{"use strict";class t{constructor(t){this.size=t,this.board=this.createBoard(t),this.shots=[],this.hits=[],this.ships=[]}createBoard(t=this.size){let e=[];for(let s=0;s<t;s++){e[s]=[];for(let i=0;i<t;i++)e[s][i]=i}return e}placeShip(t,e,s,i){let l=[];return"battleship"==t&&("vertical"==i?l.push([e,s],[e,s+1],[e,s+2],[e,s+3]):"horizontal"==i&&l.push([e,s],[e+1,s],[e+2,s],[e+3,s])),"carrier"==t&&("vertical"==i?l.push([e,s],[e,s+1],[e,s+2],[e,s+3],[e,s+4]):"horizontal"==i&&l.push([e,s],[e+1,s],[e+2,s],[e+3,s],[e+4,s])),"cruiser"==t&&("vertical"==i?l.push([e,s],[e,s+1]):"horizontal"==i&&l.push([e,s],[e+1,s])),"destroyer"==t&&("vertical"==i?l.push([e,s],[e,s+1],[e,s+2]):"horizontal"==i&&l.push([e,s],[e+1,s],[e+2,s])),"submarine"==t&&("vertical"==i?l.push([e,s],[e,s+1],[e,s+2]):"horizontal"==i&&l.push([e,s],[e+1,s],[e+2,s])),l}receiveAttack(t,e){let s=[t,e];this.shots.push(s);for(let i=0;i<this.ships.length;i++)for(let l=0;l<this.ships[i].location.length;l++)if(t==this.ships[i].location[l][0]&&e==this.ships[i].location[l][1])return this.hits.push(s),1==this.ships[i].hit(s)?(alert("Hit!"),[t,e,!0]):(alert("Hit!"),[t,e]);return alert("Miss!"),!1}}class e{constructor(t,e){this.name=t,this.size=e,this.location=[],this.hits=[],this.sunk=!1}hit(t){if(this.hits.push(t),this.isSunk(),1==this.sunk)return!0}isSunk(){this.hits.length==this.size&&(this.sunk=!0,alert(`You sunk my ${this.name}!`))}}class s{constructor(e,s){this.isHuman=e,this.turn=s,this.myBoard=new t(10),this.myShips=[],this.shots=[],this.myHits=[],this.shotSearch=[]}place(t,s,i,l,h){if("vertical"==h&&l+s>this.myBoard.size)return void alert("Please select a valid location!");if("horizontal"==h&&i+s>this.myBoard.size)return void alert("Please select a valid location!");for(let t=0;t<this.myShips.length;t++)for(let e=0;e<this.myShips[t].location.length;e++){let s=this.myShips[t].location[e][0],h=this.myShips[t].location[e][1];if(s==i&&h==l)return void alert("There is already a ship here!")}let a=new e(t,s);a.location=this.myBoard.placeShip(t,i,l,h),this.myBoard.ships.push(a),this.myShips.push(a)}shoot(t,e,s){let i=[t,e];for(let s=0;s<this.shots.length;s++)if(t==this.shots[s][0]&&e==this.shots[s][1])return void alert("You cannot target the same spot twice!");this.shots.push(i);const l=s.myBoard.receiveAttack(t,e);if(0!=l)return this.myHits.push(l),!0}aiPlace(t,s){let i=Math.floor(Math.random()*(this.myBoard.size-s)),l=Math.floor(Math.random()*this.myBoard.size),h=Math.floor(Math.random()*this.myBoard.size),a=Math.floor(Math.random()*(this.myBoard.size-s));for(let t=0;t<this.myShips.length;t++)for(let e=0;e<this.myShips[t].location.length;e++){let r=this.myShips[t].location[e][0],o=this.myShips[t].location[e][1];for(let t=0;t<s;t++)if(r==h+t&&o==a+t||r==i+t&&o==l+t)return}let r=new e(t,s),o=Math.round(Math.random());r.location=o>0?this.myBoard.placeShip(t,i,l,"horizontal"):this.myBoard.placeShip(t,h,a,"vertical"),this.myBoard.ships.push(r),this.myShips.push(r)}aiShoot(t){if(0!=this.shotSearch.length){let e=this.shotSearch[0][0],s=this.shotSearch[0][1];for(let i=0;i<this.shots.length;i++)if(e==this.shots[i][0]&&s==this.shots[i][1])return this.shotSearch.shift(),this.aiShoot(t);let i=t.myBoard.receiveAttack(e,s);return this.shots.push([e,s]),1==i?(this.myHits=[],this.shotSearch=[],[e,s,!0]):0!=i?(this.myHits.push(i),this.shotSearch=[],this.aiDestroy(),[e,s,!0]):(this.shotSearch.shift(),[e,s,!1])}{this.myHits=[];let e=Math.floor(Math.random()*t.myBoard.size),s=Math.floor(Math.random()*t.myBoard.size);for(let i=0;i<this.shots.length;i++)if(e==this.shots[i][0]&&s==this.shots[i][1])return this.aiShoot(t);let i=t.myBoard.receiveAttack(e,s);return this.shots.push([e,s]),0!=i?(this.myHits.push(i),this.shotSearch=[],this.aiDestroy(),[e,s,!0]):[e,s,!1]}}aiDestroy(){if(1==this.myHits.length){const t=this.myHits[0][0],e=this.myHits[0][1];e<9&&this.shotSearch.push([t,e+1]),e>0&&this.shotSearch.push([t,e-1]),t>0&&this.shotSearch.push([t-1,e]),t<9&&this.shotSearch.push([t+1,e])}else if(this.myHits.length>1){const t=this.myHits[0][0],e=this.myHits[0][1],s=this.myHits[this.myHits.length-1][0],i=this.myHits[this.myHits.length-1][1];t==s&&e<i?this.shotSearch.push([t,e-1],[s,i+1]):t==s&&e>i?this.shotSearch.push([t,e+1],[s,i-1]):e==i&&t<s?this.shotSearch.push([t-1,e],[s+1,i]):e==i&&t>s&&this.shotSearch.push([t+1,e],[s-1,i])}}}const i=document.getElementById("myGrid"),l=document.getElementsByClassName("myTile"),h=document.getElementById("aiGrid"),a=document.getElementsByClassName("aiTile");h.style.visibility="hidden";const r=document.getElementById("preview"),o=document.getElementById("shipPreview"),d=new s(!0,!0),n=new s(!1,!1);let c=!0;const m=document.getElementById("direction");let p="vertical";m.addEventListener("click",(()=>{"vertical"==p?(p="horizontal",r.style.flexDirection="row"):"horizontal"==p&&(p="vertical",r.style.flexDirection="column")}));const u=()=>{for(;n.myShips.length<5;)if(0==n.myShips.length)n.aiPlace("carrier",5);else if(1==n.myShips.length)n.aiPlace("battleship",4);else if(2==n.myShips.length)n.aiPlace("destroyer",4);else if(3==n.myShips.length)n.aiPlace("submarine",4);else{if(4!=n.myShips.length)break;n.aiPlace("cruiser",2)}},y=()=>{if(0==d.myShips.length){let t=document.createElement("div");t.classList.add("previewTile"),r.appendChild(t);for(let t=0;t<4;t++){let t=document.createElement("div");t.classList.add("previewDisplay"),r.appendChild(t)}}else if(1==d.myShips.length){let t=document.createElement("div");t.classList.add("previewTile"),r.appendChild(t);for(let t=0;t<3;t++){let t=document.createElement("div");t.classList.add("previewDisplay"),r.appendChild(t)}}else if(2==d.myShips.length){let t=document.createElement("div");t.classList.add("previewTile"),r.appendChild(t);for(let t=0;t<2;t++){let t=document.createElement("div");t.classList.add("previewDisplay"),r.appendChild(t)}}else if(3==d.myShips.length){let t=document.createElement("div");t.classList.add("previewTile"),r.appendChild(t);for(let t=0;t<2;t++){let t=document.createElement("div");t.classList.add("previewDisplay"),r.appendChild(t)}}else if(4==d.myShips.length){let t=document.createElement("div");t.classList.add("previewTile"),r.appendChild(t);for(let t=0;t<1;t++){let t=document.createElement("div");t.classList.add("previewDisplay"),r.appendChild(t)}}else for(;r.firstChild;)r.removeChild(r.firstChild)},f=(t,e,s)=>{let i=0;for(let l=0;l<t;l++){let h=document.createElement("div");h.id=l,e.appendChild(h);for(let e=0;e<t;e++){let t=document.createElement("div");t.id=i<10?`0${i}`:i,i++,1==s?t.classList.add("myTile"):0==s&&t.classList.add("aiTile"),t.addEventListener("mouseenter",(()=>{t.classList.add("hover")})),t.addEventListener("mouseleave",(()=>{t.classList.remove("hover")})),h.appendChild(t)}}},v=()=>{for(let t=0;t<l.length;t++)l[t].addEventListener("click",(()=>{const e=String(l[t].id)[0],s=Number(e),i=String(l[t].id).slice(-1),a=Number(i);if(d.myShips.length<5){if(0==d.myShips.length){if(d.place("carrier",5,s,a,p),"vertical"==p&&a<6){l[t].classList.add("placed");for(let t=0;t<5;t++)document.getElementById(`${s}${a+t}`).classList.add("placed")}else if("horizontal"==p&&s<6){l[t].classList.add("placed");for(let t=0;t<5;t++)document.getElementById(`${s+t}${a}`).classList.add("placed")}}else if(1==d.myShips.length){if(d.place("battleship",4,s,a,p),"vertical"==p&&a<7){l[t].classList.add("placed");for(let t=0;t<4;t++)document.getElementById(`${s}${a+t}`).classList.add("placed")}else if("horizontal"==p&&s<7){l[t].classList.add("placed");for(let t=0;t<4;t++)document.getElementById(`${s+t}${a}`).classList.add("placed")}}else if(2==d.myShips.length){if(d.place("destroyer",3,s,a,p),"vertical"==p&&a<8){l[t].classList.add("placed");for(let t=0;t<3;t++)document.getElementById(`${s}${a+t}`).classList.add("placed")}else if("horizontal"==p&&s<8){l[t].classList.add("placed");for(let t=0;t<3;t++)document.getElementById(`${s+t}${a}`).classList.add("placed")}}else if(3==d.myShips.length){if(d.place("submarine",3,s,a,p),"vertical"==p&&a<8){l[t].classList.add("placed");for(let t=0;t<3;t++)document.getElementById(`${s}${a+t}`).classList.add("placed")}else if("horizontal"==p&&s<8){l[t].classList.add("placed");for(let t=0;t<3;t++)document.getElementById(`${s+t}${a}`).classList.add("placed")}}else if(4==d.myShips.length){if(d.place("cruiser",2,s,a,p),"vertical"==p&&a<9){l[t].classList.add("placed");for(let t=0;t<2;t++)document.getElementById(`${s}${a+t}`).classList.add("placed")}else if("horizontal"==p&&s<9){l[t].classList.add("placed");for(let t=0;t<2;t++)document.getElementById(`${s+t}${a}`).classList.add("placed")}}else alert("You have no ships remaining!");for(;r.firstChild;)r.removeChild(r.firstChild);y()}5==d.myShips.length&&(o.style.visibility="hidden",u(),h.style.visibility="visible",g())}))},S=()=>{if(1!=c&&0==c){let t=n.aiShoot(d);console.log(t);let e=t[0],s=t[1];for(let i=0;i<l.length;i++){let h=String(l[i].id)[0],a=Number(h),r=String(l[i].id).slice(-1),o=Number(r);1==t[2]&&e==a&&s==o?l[i].classList.add("hit"):0==t[2]&&e==a&&s==o&&l[i].classList.add("shot")}L(d),c=!0}},g=()=>{for(let t=0;t<a.length;t++)a[t].addEventListener("click",(()=>{if(0!=c){if(1==c){let e=String(a[t].id)[0],s=Number(e),i=String(a[t].id).slice(-1),l=Number(i);1==d.shoot(s,l,n)?a[t].classList.add("hit"):a[t].classList.add("shot"),c=!1,0==L(n)&&setTimeout(S,1e3)}}else alert("It's not your turn!")}))},L=t=>{if(17==t.myBoard.hits.length){for(0==t.isHuman?alert("You win!"):1==t.isHuman&&alert("You lose!");i.firstChild;)h.removeChild(h.firstChild),i.removeChild(i.firstChild);return confirm("Play again?")?(d.turn=!0,d.myBoard=new Gameboard(10),d.myShips=[],d.shots=[],d.myHits=[],d.shotSearch=[],n.turn=!1,n.myBoard=new Gameboard(10),n.myShips=[],n.shots=[],n.myHits=[],n.shotSearch=[],f(10,i,!0),y(),v(),f(10,h,!1),o.style.visibility="visible"):alert("Thank you for playing!"),!0}return!1};f(10,i,!0),y(),v(),f(10,h,!1)})();